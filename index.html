<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      margin: 0;
      background: #0b0b0b;
      background-image: radial-gradient(#1a1a1a 1px, transparent 1px);
      background-size: 6px 6px;
      color: #cfcfcf;
      font-family: Arial, "Segoe UI", sans-serif;
    }

    .container {
  max-width: 1200px;
  width: 100%;
  padding: 16px;
  margin: 0 auto;
  box-sizing: border-box;
}

    .panel {
      border: 1px solid #6b6430;
      background: linear-gradient(#141414, #0c0c0c);
      padding: 10px 12px 12px;
      margin-bottom: 14px;
    }

    .panel-title {
      color: #f1dc55;
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .options {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.btn {
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid #d1c45c;
  background: linear-gradient(135deg, #f1dc55, #e0c24f);
  color: #000;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s ease;
  white-space: nowrap;
}

/* hover */
.btn:hover {
  background: linear-gradient(135deg, #fff3a3, #f1d35c);
  box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
  transform: translateY(-1px);
}

/* í´ë¦­ */
.btn:active {
  transform: translateY(1px);
  box-shadow: none;
}

/* ì„ íƒ ìƒíƒœ */
.btn.active {
  background: #88FF88;
  border-color: #88FF88;
  color: #000;
  box-shadow: 0 0 8px rgba(136, 255, 136, 0.6);
}

/* ë¹„í™œì„± */
.btn.disabled {
  opacity: 0.25;
  pointer-events: none;
  border-color: #444;
  color: #555;
  background: #222;
  box-shadow: none;
  transform: none;
}

/* ì´ˆê¸°í™” ë²„íŠ¼ë§Œ ì‚´ì§ ë‹¤ë¥´ê²Œ */
.btn.reset {
  font-size: 12px;
  padding: 5px 10px;
  background: linear-gradient(135deg, #ff4d4d, #b30000);
  border-color: #ff4d4d;
  color: #000;
}

/* hover */
.btn.reset:hover {
  background: linear-gradient(135deg, #ff6666, #cc0000);
  box-shadow: 0 0 10px rgba(255, 0, 0, 0.6);
}
.btn.ok { 
  font-size: 12px;
  padding: 5px 10px;
  background: linear-gradient(135deg, #4dff88, #00b33c);
  border-color: #00cc44;
  color: #003300;
}
.btn.ok:hover {
  background: linear-gradient(135deg, #66ffaa, #00cc44);
  box-shadow: 0 0 10px rgba(0, 255, 100, 0.6);
}
/* active */
.btn.reset:active {
  background: linear-gradient(135deg, #cc0000, #800000);
}
    
    /* ê²°ê³¼ ì¹´ë“œ ë˜í¼ */
.result-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px;
}

/* ì¹´ë“œ */
.result-card {
  border: 1px solid #6b6430;
  background: linear-gradient(#161616, #0d0d0d);
  padding: 8px 10px;
  border-radius: 4px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03);
}

/* ì´ë¦„ */
.result-name {
  color: #f1dc55;
  font-size: 13px;
  font-weight: 700;
  margin-bottom: 4px;
}

/* ì˜µì…˜ í…ìŠ¤íŠ¸ */
.result-option {
  font-size: 13px;
  color: #cfcfcf;
  line-height: 1.4;
}

/* ê²°ê³¼ ì—†ìŒ */
.hint {
  color: #777;
  font-size: 20px;
}
.result-card {
  background: linear-gradient(135deg, #111, #1b1b1b);
  border: 1px solid #3a3a3a;
  border-radius: 8px;
  padding: 14px;
  color: #fff;
  width: 300px;
  box-sizing: border-box;
}

/* ìƒë‹¨ */
.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.card-title {
  font-size: 15px;
  font-weight: 700;
  color: #fff;
}

.card-grade {
  font-size: 12px;
  padding: 3px 7px;
  border-radius: 6px;
  background: #2a2a2a;
  color: #ccc;
}

.card-options {
  display: flex;
  gap: 6px;
  margin: 8px 0;
  flex-wrap: wrap;
}

.option-tag {
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 4px;
  background: #2a2a2a;
  color: #ccc;
  transition: 0.2s;
}

.option-tag.selected {
  background: #88FF88;
  color: #000;
  font-weight: 600;
}

/* ì§€ì—­ */
.card-desc {
  font-size: 12px;
  color: #aaa;
}
.result-list {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;   /* â­ ì´ê²Œ í•µì‹¬ */
}
.result-card {
  background: linear-gradient(#151515, #0e0e0e);
  border: 1px solid #333;
  border-radius: 10px;
  padding: 14px;
  box-sizing: border-box;
}
/* 6ì„± */
.grade-6 {
  border-color: #ff2a2a;
  box-shadow: 0 0 15px rgba(255, 0, 0, 0.6);
}

/* 5ì„± */
.grade-5 {
  border-color: #ffd700;
  box-shadow: 0 0 12px rgba(255, 215, 0, 0.7);
}
.card-image {
  width: 100%;
  height: 160px;
  overflow: hidden;
  border-radius: 8px;
  margin-bottom: 8px;
}

.card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;   /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ê½‰ ì±„ì›€ */
  display: block;
}
.result-card.excluded {
  filter: grayscale(100%);
  opacity: 0.35;
  transform: scale(0.97);
  transition: 0.2s;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header-buttons {
  display: flex;
  gap: 8px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
}
/* ì „ì²´ ì»¨í…Œì´ë„ˆ ë ˆì´ì•„ì›ƒ */
.toggle-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 5px 12px;
  background: rgba(0, 0, 0, 0.2); /* ë°°ê²½ì— ì‚´ì§ ìŒì˜ */
  border-radius: 8px;
  border: 1px solid #00cc44;
  width: fit-content;
  gap: 15px;
}

.toggle-text {
  font-size: 12px;
  color: #4dff88; /* í…ìŠ¤íŠ¸ë„ ë²„íŠ¼ ìƒ‰ìƒê³¼ í†µì¼ */
  font-weight: bold;
}

/* ìŠ¤ìœ„ì¹˜ ë³¸ì²´ */
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 44px;
  height: 22px;
}

/* ì²´í¬ë°•ìŠ¤ ìˆ¨ê¸°ê¸° */
.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* ìŠ¬ë¼ì´ë” ë°°ê²½ (OFF ìƒíƒœ) */
.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background: #333; /* êº¼ì¡Œì„ ë•ŒëŠ” ì–´ë‘¡ê²Œ */
  transition: .3s;
  border-radius: 22px;
  border: 1px solid #444;
}

/* ìŠ¬ë¼ì´ë” ë‚´ë¶€ ì› */
.toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 3px;
  bottom: 2px;
  background: #bbb;
  transition: .3s;
  border-radius: 50%;
}

/* ğŸŸ¢ ì²´í¬ë˜ì—ˆì„ ë•Œ (ON ìƒíƒœ) - .btn.ok ìŠ¤íƒ€ì¼ ì ìš© */
input:checked + .toggle-slider {
  background: linear-gradient(135deg, #4dff88, #00b33c);
  border-color: #00cc44;
  box-shadow: 0 0 10px rgba(0, 255, 100, 0.4);
}

input:checked + .toggle-slider:before {
  transform: translateX(20px);
  background: #fff; /* ONì¼ ë•Œ ì›ì„ í•˜ì–—ê²Œ ê°•ì¡° */
  box-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
}

/* í˜¸ë²„ íš¨ê³¼ */
.toggle-wrapper:hover {
  box-shadow: 0 0 10px rgba(0, 255, 100, 0.3);
  transition: 0.3s;
}
  </style>
</head>
<body>

<div class="container">

  <div class="panel">
    <div class="panel-header">
    <div class="panel-title">ê¸°ì´ˆ ì˜µì…˜</div>
     <div class="toggle-wrapper">
        <button id="resetGray" onclick="clearExcluded()" class="btn reset">âŸ³ íŒŒë° ì´ˆê¸°í™”</button>
  <span class="toggle-text">íŒŒë° ì™„ë£Œ</span>
  <label class="toggle-switch">
    <input type="checkbox" id="showExcluded">
    <span class="toggle-slider"></span>
  </label>
</div>
    
  </div>
    <div class="options" id="primary"></div>
  </div>

  <div class="panel">
    <div class="panel-title">ì¶”ê°€ ì˜µì…˜</div>
    <div class="options" id="secondary"></div>
  </div>

  <div class="panel">
    <div class="panel-title">ìŠ¤í‚¬ ì˜µì…˜</div>
    <div class="options" id="skill"></div>
  </div>
  <div class="panel">
    <div class="panel-title">ì§€ì—­</div>
    <div class="options" id="area"></div>
  </div>
  <div class="panel">
  <div class="panel-title">ë¬´ê¸°</div>
  <div id="result" class="result-list"></div>
</div>
</div>

<script>
let dbdata = [];
let optiondata = {};
let currentResult = [];
let excludedIds = new Set(JSON.parse(localStorage.getItem("excludedCards") || "[]"));
let viewMode = "normal";

const selected = {
  primary: [],
  secondary: null,
  skill: null,
  area: null
};

//////////////////////////////////////////////////////////
// âœ… ë°ì´í„° ë¡œë“œ
//////////////////////////////////////////////////////////
async function loadData() { 
  try {
    const res = await fetch("db.json?v=" + new Date().getTime());
    const data = await res.json();

    console.log("ë¡œë“œëœ ë°ì´í„°:", data);

    dbdata = Array.isArray(data) ? data : [];
    optiondata = generateOptions(dbdata);

    console.log("ìƒì„±ëœ ì˜µì…˜:", optiondata);

    init();
    updateResult();

  } catch (e) { 
    console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", e);
  }
}

//////////////////////////////////////////////////////////
// âœ… ì˜µì…˜ ìë™ ìƒì„± (ì™„ì „ ì•ˆì „ ë²„ì „)
//////////////////////////////////////////////////////////
function generateOptions(db) {
  const primary = new Set();
  const secondary = new Set();
  const skill = new Set();
  const area = new Set();

  db.forEach(row => {
    if (!row) return;

    if (row["ì˜µì…˜1"]) primary.add(row["ì˜µì…˜1"].toString().trim());
    if (row["ì˜µì…˜2"]) secondary.add(row["ì˜µì…˜2"].toString().trim());
    if (row["ì˜µì…˜3"]) skill.add(row["ì˜µì…˜3"].toString().trim());

    if (row["ì§€ì—­"]) {
      if (Array.isArray(row["ì§€ì—­"])) {
        row["ì§€ì—­"].forEach(a => {
          if (a) area.add(a.toString().trim());
        });
      } else {
        row["ì§€ì—­"]
          .toString()
          .split(",")
          .map(v => v.trim())
          .forEach(a => {
            if (a) area.add(a);
          });
      }
    }
  });

  return {
    primary: [...primary].sort(),
    secondary: [...secondary].sort(),
    skill: [...skill].sort(),
    area: [...area].sort()
  };
}

//////////////////////////////////////////////////////////
// âœ… ì´ˆê¸° ë²„íŠ¼ ìƒì„±
//////////////////////////////////////////////////////////
function init() {

  if (!optiondata || !optiondata.primary) {
    console.error("optiondata ì˜¤ë¥˜:", optiondata);
    return;
  }

  createButtons("primary", optiondata.primary);
  createButtons("secondary", optiondata.secondary);
  createButtons("skill", optiondata.skill);
  createButtons("area", optiondata.area);

  const toggleBtn = document.getElementById("showExcluded");

  toggleBtn.addEventListener("change", function () {
    viewMode = this.checked ? "excluded" : "normal";
    updateResult();
    updateOptionAvailability();
  });
}

//////////////////////////////////////////////////////////
// âœ… ë²„íŠ¼ ìƒì„±
//////////////////////////////////////////////////////////
function createButtons(type, list) {

  if (!Array.isArray(list)) {
    console.error("list ë°°ì—´ ì•„ë‹˜:", type, list);
    return;
  }

  const wrap = document.getElementById(type);
  wrap.innerHTML = "";

  list.forEach(value => {
    const btn = document.createElement("div");
    btn.className = "btn";
    btn.textContent = value;
    btn.onclick = () => toggle(type, value, btn);
    wrap.appendChild(btn);
  });
}

//////////////////////////////////////////////////////////
// âœ… ê²°ê³¼ ì—…ë°ì´íŠ¸
//////////////////////////////////////////////////////////
function updateResult() {

  const resultEl = document.getElementById("result");
  resultEl.innerHTML = "";

  const hasPrimary = selected.primary.length > 0;
  const isAnySelected = hasPrimary || selected.secondary || selected.skill || selected.area;

  let result = [];

  if (viewMode === "excluded") {
    result = dbdata.filter(row => excludedIds.has(row["ì´ë¦„"]));
    if (result.length === 0) {
      resultEl.innerHTML = `<div class="hint">íŒŒë° ì™„ë£Œí•œ ë¬´ê¸° ì—†ìŒ</div>`;
      return;
    }
  } else {

    if (!isAnySelected) {
      resultEl.innerHTML = `<div class="hint">ğŸ” ì˜µì…˜ì„ ì„ íƒí•˜ì„¸ìš”.</div>`;
      return;
    }

    result = dbdata.filter(row => {

      if (!row) return false;
      if (excludedIds.has(row["ì´ë¦„"])) return false;

      const rowOpts = [
        row["ì˜µì…˜1"],
        row["ì˜µì…˜2"],
        row["ì˜µì…˜3"]
      ].filter(Boolean).map(v => v.toString().trim());

      const passPrimary = !hasPrimary ||
        selected.primary.some(sel => rowOpts.includes(sel));

      const passSecondary = !selected.secondary ||
        rowOpts.includes(selected.secondary);

      const passSkill = !selected.skill ||
        rowOpts.includes(selected.skill);

      const passArea = !selected.area ||
        (row["ì§€ì—­"] &&
          (Array.isArray(row["ì§€ì—­"])
            ? row["ì§€ì—­"].includes(selected.area)
            : row["ì§€ì—­"].toString().includes(selected.area)));

      return passPrimary && passSecondary && passSkill && passArea;
    });
  }

  if (result.length === 0) {
    resultEl.innerHTML = `<div class="hint">ê²°ê³¼ ì—†ìŒ</div>`;
    return;
  }

  result.forEach(row => {

   const card = document.createElement("div");
const grade = row["ì„±ê¸‰"] || "5ì„±";
const id = row["ì´ë¦„"];

card.className = "result-card grade-" + grade.replace("ì„±", "");
card.dataset.id = id;

const baseUrl = "https://cdn.jsdelivr.net/gh/kuu6132/end-field@main/%EB%AC%B4%EA%B8%B0/";
const imageUrl = row["ì´ë¦„"]
  ? baseUrl + encodeURIComponent(row["ì´ë¦„"]) + ".png"
  : "";

const areaText = Array.isArray(row["ì§€ì—­"])
  ? row["ì§€ì—­"].join(", ")
  : row["ì§€ì—­"] ?? "";

card.innerHTML = `
  <div class="card-image">
    <img src="${imageUrl}">
  </div>

  <div class="card-header">
    <div class="card-title">${row["ì´ë¦„"]}</div>
    <div class="card-grade">${row["ì„±ê¸‰"]}</div>
  </div>

  <div class="card-options">
    ${row["ì˜µì…˜1"] ? `
      <span class="option-tag ${isSelected(row["ì˜µì…˜1"]) ? "selected" : ""}">
        ${row["ì˜µì…˜1"]}
      </span>` : ""}

    ${row["ì˜µì…˜2"] ? `
      <span class="option-tag ${isSelected(row["ì˜µì…˜2"]) ? "selected" : ""}">
        ${row["ì˜µì…˜2"]}
      </span>` : ""}

    ${row["ì˜µì…˜3"] ? `
      <span class="option-tag ${isSelected(row["ì˜µì…˜3"]) ? "selected" : ""}">
        ${row["ì˜µì…˜3"]}
      </span>` : ""}
  </div>

  <div class="card-desc">
    ğŸ“ ${areaText}
  </div>
`;


    resultEl.appendChild(card);
  });

  currentResult = result;
  updateOptionAvailability();
}
function isSelected(option) {
  if (!option) return false;

  return (
    selected.primary.includes(option) ||
    selected.secondary === option ||
    selected.skill === option
  );
}

//////////////////////////////////////////////////////////
// âœ… ì˜µì…˜ í™œì„±í™” ì œì–´
//////////////////////////////////////////////////////////
function updateOptionAvailability() {

  const types = ["primary", "secondary", "skill", "area"];

  types.forEach(type => {

    document.querySelectorAll(`#${type} .btn`).forEach(btn => {

      const value = btn.textContent;

      const testSelection = { ...selected };

      if (type === "primary") {
        testSelection.primary = [...selected.primary, value];
      } else {
        testSelection[type] = value;
      }

      const possible = dbdata.some(row => {

        if (!row) return false;
        if (excludedIds.has(row["ì´ë¦„"])) return false;

        const rowOpts = [
          row["ì˜µì…˜1"],
          row["ì˜µì…˜2"],
          row["ì˜µì…˜3"]
        ].filter(Boolean).map(v => v.toString().trim());

        const passPrimary =
          testSelection.primary.length === 0 ||
          testSelection.primary.some(sel => rowOpts.includes(sel));

        const passSecondary =
          !testSelection.secondary ||
          rowOpts.includes(testSelection.secondary);

        const passSkill =
          !testSelection.skill ||
          rowOpts.includes(testSelection.skill);

        const passArea =
          !testSelection.area ||
          (row["ì§€ì—­"] &&
            (Array.isArray(row["ì§€ì—­"])
              ? row["ì§€ì—­"].includes(testSelection.area)
              : row["ì§€ì—­"].toString().includes(testSelection.area)));

        return passPrimary && passSecondary && passSkill && passArea;
      });

      btn.classList.toggle("disabled", !possible);
    });
  });
}

//////////////////////////////////////////////////////////
// âœ… í† ê¸€ ì²˜ë¦¬
//////////////////////////////////////////////////////////
function toggle(type, value, btn) {

  if (type === "primary") {
    const index = selected.primary.indexOf(value);
    if (index > -1) {
      selected.primary.splice(index, 1);
      btn.classList.remove("active");
    } else {
      selected.primary.push(value);
      btn.classList.add("active");
    }
  } else {
    if (selected[type] === value) {
      selected[type] = null;
      btn.classList.remove("active");
    } else {
      selected[type] = value;
      document.querySelectorAll(`#${type} .btn`)
        .forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    }
  }

  updateResult();
}

//////////////////////////////////////////////////////////

loadData();
</script>

</body>
</html>
